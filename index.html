<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>This is IndexPage</title>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

    <style>
        * {
            
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'JetBrains Mono', monospace;
            background: #1a0b2e;
            color: #ffffff;
            overflow: hidden;
            height: 100vh;
            position: relative;
        }

        .cursor {
            position: fixed;
            width: 20px;
            height: 20px;
            border: 2px solid #b19cd9;
            border-radius: 50%;
            pointer-events: none;
            z-index: 9999;
            mix-blend-mode: difference;
            transition: transform 0.1s ease;
        }

        #galaxy-canvas {
            position: fixed;
            top: 0;
            left: 0;
            z-index: 1;
        }

        .content-layer {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: 10;
            pointer-events: none;
        }

        .section {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            opacity: 0;
            transition: opacity 0.8s ease;
            pointer-events: auto;
            max-width: 90vw;
            padding: 2rem;
        }

        .section.active {
            opacity: 1;
        }

        /* Navigation */
        .nav-controls {
            position: fixed;
            bottom: 2rem;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 1rem;
            z-index: 100;
            backdrop-filter: blur(10px);
            background: rgba(0, 0, 0, 0.3);
            padding: 1rem;
            border-radius: 50px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .nav-btn {
            width: 50px;
            height: 50px;
            border: 2px solid #b19cd9;
            background: transparent;
            border-radius: 50%;
            color: #b19cd9;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            font-weight: bold;
        }

        .nav-btn:hover {
            background: rgba(177, 156, 217, 0.2);
            transform: scale(1.1);
            box-shadow: 0 0 20px rgba(177, 156, 217, 0.5);
        }

        .nav-btn.active {
            background: #b19cd9;
            color: #1a0b2e;
        }

        /* Auth Navigation */
        .auth-nav {
            position: fixed;
            top: 2rem;
            right: 2rem;
            display: flex;
            gap: 1rem;
            z-index: 100;
        }

        .auth-nav-btn {
            padding: 0.8rem 1.5rem;
            background: rgba(26, 11, 46, 0.3);
            backdrop-filter: blur(10px);
            border: 2px solid #b19cd9;
            border-radius: 25px;
            color: #b19cd9;
            font-family: 'JetBrains Mono', monospace;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            text-decoration: none;
            display: inline-block;
            min-width: 80px;
            text-align: center;
        }

        .auth-nav-btn:hover {
            background: rgba(177, 156, 217, 0.2);
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(177, 156, 217, 0.3);
        }

        .auth-nav-btn:active {
            transform: translateY(-1px);
        }
        
        /* User Navigation */
        .user-nav {
            position: fixed;
            top: 2rem;
            right: 2rem;
            display: flex;
            gap: 1rem;
            z-index: 100;
        }

        .cosmic-btn {
            padding: 0.8rem 1.5rem;
            background: rgba(26, 11, 46, 0.3);
            backdrop-filter: blur(10px);
            border: 2px solid #b19cd9;
            border-radius: 25px;
            color: #b19cd9;
            font-family: 'JetBrains Mono', monospace;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            text-decoration: none;
            display: inline-block;
            min-width: 80px;
            text-align: center;
        }

        .cosmic-btn:hover {
            background: rgba(177, 156, 217, 0.2);
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(177, 156, 217, 0.3);
        }

        .cosmic-btn:active {
            transform: translateY(-1px);
        }
        
        /* Auth Modal Styles */
        .auth-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(26, 11, 46, 0.8);
            backdrop-filter: blur(10px);
            z-index: 2000;
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.5s ease;
        }

        .auth-modal.active {
            opacity: 1;
            pointer-events: auto;
        }

        .auth-modal-content {
            background: linear-gradient(145deg, rgba(177, 156, 217, 0.25), rgba(155, 89, 182, 0.25));
            border: 2px solid #b19cd9;
            border-radius: 20px;
            padding: 2.5rem;
            max-width: 90%;
            width: 400px;
            box-shadow: 0 10px 50px rgba(177, 156, 217, 0.5);
            backdrop-filter: blur(15px);
            transform: translateY(30px) scale(0.95);
            opacity: 0;
            transition: all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
            position: relative;
        }

        .auth-modal.active .auth-modal-content {
            transform: translateY(0) scale(1);
            opacity: 1;
        }

        .auth-modal-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .auth-modal-header h2 {
            font-size: clamp(1.5rem, 5vw, 2rem);
            margin-bottom: 0.5rem;
            background: linear-gradient(45deg, #d8b2ff, #9b59b6);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .auth-modal-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            width: 30px;
            height: 30px;
            border: 2px solid #b19cd9;
            border-radius: 50%;
            background: transparent;
            color: #b19cd9;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .auth-modal-close:hover {
            background: rgba(177, 156, 217, 0.3);
            transform: rotate(90deg);
        }

        .auth-form {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .auth-input-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .auth-input-group label {
            color: #e1d4ff;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .auth-input-group input {
            padding: 0.8rem;
            background: rgba(26, 11, 46, 0.5);
            border: 2px solid #b19cd9;
            border-radius: 10px;
            color: #ffffff;
            font-family: 'JetBrains Mono', monospace;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .auth-input-group input:focus {
            outline: none;
            border-color: #d8b2ff;
            box-shadow: 0 0 15px rgba(216, 178, 255, 0.5);
        }

        .auth-submit-btn {
            padding: 0.8rem 1.5rem;
            background: rgba(177, 156, 217, 0.3);
            border: 2px solid #b19cd9;
            border-radius: 30px;
            color: #e1d4ff;
            font-weight: 500;
            font-family: 'JetBrains Mono', monospace;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 1rem;
        }

        .auth-submit-btn:hover {
            background: rgba(155, 89, 182, 0.5);
            box-shadow: 0 0 20px rgba(177, 156, 217, 0.5);
            transform: translateY(-3px);
        }

        .auth-switch {
            text-align: center;
            margin-top: 1rem;
            color: #cccccc;
            font-size: 0.9rem;
        }

        .auth-switch a {
            color: #d8b2ff;
            text-decoration: none;
            transition: color 0.3s ease;
        }

        .auth-switch a:hover {
            color: #b19cd9;
        }

        .zoom-controls {
            position: fixed;
            right: 2rem;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            flex-direction: column;
            gap: 1rem;
            z-index: 100;
        }

        .zoom-btn {
            width: 50px;
            height: 50px;
            border: 2px solid #9b59b6;
            background: rgba(26, 11, 46, 0.5);
            backdrop-filter: blur(10px);
            border-radius: 50%;
            color: #9b59b6;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: bold;
        }

        .zoom-btn:hover {
            background: rgba(155, 89, 182, 0.2);
            transform: scale(1.1);
            box-shadow: 0 0 20px rgba(155, 89, 182, 0.5);
        }

        /* Big Bang Transition Effect Styles */
        .big-bang-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #1a0b2e;
            z-index: 2000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 1s ease;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }

        .big-bang-overlay.active {
            opacity: 1;
            pointer-events: auto;
        }

        .big-bang-core {
            width: 10px;
            height: 10px;
            background: white;
            border-radius: 50%;
            position: relative;
            box-shadow: 0 0 50px 20px rgba(255, 255, 255, 0.8),
                        0 0 100px 40px rgba(177, 156, 217, 0.6);
            transform-origin: center;
            transform: scale(0);
        }

        .energy-wave {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: radial-gradient(
                circle,
                rgba(255, 255, 255, 1) 0%,
                rgba(216, 178, 255, 0.8) 30%,
                rgba(177, 156, 217, 0.6) 50%,
                rgba(155, 89, 182, 0.4) 70%,
                transparent 100%
            );
            transform: translate(-50%, -50%);
            z-index: -1;
        }

        .star-particle {
            position: absolute;
            width: 3px;
            height: 3px;
            background: white;
            border-radius: 50%;
            box-shadow: 0 0 10px 2px rgba(255, 255, 255, 0.8);
            opacity: 0;
        }
        
        /* Section Styles */
        .intro h1 {
            font-size: clamp(2rem, 8vw, 6rem);
            font-weight: 700;
            margin-bottom: 2rem;
            background: linear-gradient(45deg, #b19cd9, #9b59b6, #d8b2ff, #e6e6fa);
            background-size: 400% 400%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: galaxy-gradient 4s ease-in-out infinite;
        }

        @keyframes galaxy-gradient {
            0%, 100% { background-position: 0% 50%; }
            25% { background-position: 100% 50%; }
            50% { background-position: 50% 100%; }
            75% { background-position: 50% 0%; }
        }

        .typing-text {
            font-size: clamp(1rem, 4vw, 2rem);
            color: #b19cd9;
            margin-bottom: 3rem;
            min-height: 3rem;
            text-shadow: 0 0 10px rgba(177, 156, 217, 0.5);
        }

        .cta-buttons {
            display: flex;
            gap: 2rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn {
            padding: 1rem 2rem;
            background: rgba(26, 11, 46, 0.3);
            backdrop-filter: blur(10px);
            border: 2px solid #b19cd9;
            color: #b19cd9;
            text-decoration: none;
            font-family: inherit;
            font-weight: 500;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            border-radius: 10px;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(177, 156, 217, 0.3);
            background: rgba(177, 156, 217, 0.1);
        }



        /* Custom Popup Styles */
        .popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(26, 11, 46, 0.8);
            backdrop-filter: blur(10px);
            z-index: 1000;
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.5s ease;
        }

        .popup-overlay.active {
            opacity: 1;
            pointer-events: auto;
        }

        .popup-content {
            background: linear-gradient(145deg, rgba(177, 156, 217, 0.25), rgba(155, 89, 182, 0.25));
            border: 2px solid #b19cd9;
            border-radius: 20px;
            padding: 2rem;
            max-width: 90%;
            width: 500px;
            box-shadow: 0 10px 50px rgba(177, 156, 217, 0.5);
            backdrop-filter: blur(15px);
            transform: translateY(30px) scale(0.95);
            opacity: 0;
            transition: all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
            position: relative;
        }

        .popup-overlay.active .popup-content {
            transform: translateY(0) scale(1);
            opacity: 1;
        }

        .popup-header {
            text-align: center;
            margin-bottom: 1.5rem;
        }

        .popup-header h2 {            font-size: clamp(1.5rem, 5vw, 2.5rem);
            margin-bottom: 0.5rem;
            background: linear-gradient(45deg, #d8b2ff, #9b59b6);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .popup-body {
            color: #e1d4ff;
            line-height: 1.6;
            margin-bottom: 2rem;
        }

        .popup-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            width: 30px;
            height: 30px;
            border: 2px solid #b19cd9;
            border-radius: 50%;
            background: transparent;
            color: #b19cd9;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .popup-close:hover {
            background: rgba(177, 156, 217, 0.3);
            transform: rotate(90deg);
        }
        
        .popup-actions {
            display: flex;
            justify-content: center;
            gap: 1.5rem;
            margin-top: 2rem;
        }
        
        .popup-btn {
            padding: 0.9rem 1.8rem;
            background: linear-gradient(45deg, rgba(177, 156, 217, 0.2), rgba(155, 89, 182, 0.4));
            border: 2px solid #b19cd9;
            border-radius: 30px;
            color: #ffffff;
            font-family: 'JetBrains Mono', monospace;
            font-weight: 500;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
            overflow: hidden;
            text-shadow: 0 0 5px rgba(216, 178, 255, 0.8);
            box-shadow: 0 5px 15px rgba(177, 156, 217, 0.3);
            letter-spacing: 0.5px;
        }
        
        .popup-btn:before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.7s ease;
        }
        
        .popup-btn:hover {
            background: linear-gradient(45deg, rgba(177, 156, 217, 0.4), rgba(155, 89, 182, 0.6));
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(177, 156, 217, 0.5);
            text-shadow: 0 0 10px rgba(216, 178, 255, 1);
            border-color: #d8b2ff;
        }
        
        .popup-btn:hover:before {
            left: 100%;
        }
        
        .popup-btn:active {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(177, 156, 217, 0.3);
        }
        
        /* Different styling for each button */
        #exploreBtn {
            background: linear-gradient(45deg, rgba(123, 97, 255, 0.3), rgba(87, 65, 217, 0.5));
            border-color: #7b61ff;
        }
        
        #exploreBtn:hover {
            background: linear-gradient(45deg, rgba(123, 97, 255, 0.5), rgba(87, 65, 217, 0.7));
            border-color: #8f7aff;
        }
        
        #createCapsuleBtn {
            background: linear-gradient(45deg, rgba(216, 84, 192, 0.3), rgba(155, 89, 182, 0.5));
            border-color: #d854c0;
        }
        
        #createCapsuleBtn:hover {
            background: linear-gradient(45deg, rgba(216, 84, 192, 0.5), rgba(155, 89, 182, 0.7));
            border-color: #e672d2;
        }

        .year-selector-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(26, 11, 46, 0.7);
            backdrop-filter: blur(5px);
            z-index: 1000;
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.5s ease;
        }

        .year-selector-overlay.active {
            opacity: 1;
            pointer-events: auto;
        }

        .year-selector-content {
            background: linear-gradient(145deg, rgba(177, 156, 217, 0.25), rgba(155, 89, 182, 0.25));
            border: 2px solid #b19cd9;
            border-radius: 20px;
            padding: 2.5rem;
            max-width: 90%;
            width: 400px;
            box-shadow: 0 10px 50px rgba(177, 156, 217, 0.5);
            backdrop-filter: blur(15px);
            transform: translateY(30px) scale(0.95);
            opacity: 0;
            transition: all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
            text-align: center;
        }

        .year-selector-overlay.active .year-selector-content {
            transform: translateY(0) scale(1);
            opacity: 1;
        }

        .year-selector-header {
            margin-bottom: 1.5rem;
        }

        .year-selector-header h3 {
            font-size: 1.8rem;
            color: #e1d4ff;
        }

        .year-input {
            background: rgba(26, 11, 46, 0.5);
            border: 2px solid #b19cd9;
            font-family: 'JetBrains Mono', monospace;
            font-size: 2rem;
            padding: 0.8rem;
            width: 180px;
            text-align: center;
            color: #ffffff;
            border-radius: 10px;
            margin: 1rem auto 2rem;
            display: block;
        }

        .year-input:focus {
            outline: none;
            border-color: #d8b2ff;
            box-shadow: 0 0 15px rgba(216, 178, 255, 0.5);
        }

        .year-selector-actions {
            display: flex;
            justify-content: center;
            gap: 1rem;
        }

        .year-selector-btn {
            padding: 0.8rem 1.5rem;
            background: rgba(177, 156, 217, 0.3);
            border: 2px solid #b19cd9;
            border-radius: 30px;
            color: #e1d4ff;
            font-weight: 500;
            font-family: inherit;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .year-selector-btn:hover {
            background: rgba(155, 89, 182, 0.5);
            box-shadow: 0 0 20px rgba(177, 156, 217, 0.5);
            transform: translateY(-3px);
        }

        .year-validation-error {
            color: #ff6b9d;
            font-size: 0.9rem;
            margin-top: -1rem;
            margin-bottom: 1rem;
            display: none;
        }
        
        /* Galaxy Core Guide Popup */
        .core-guide {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -250px);
            background: rgba(26, 11, 46, 0.8);
            backdrop-filter: blur(10px);
            border: 2px solid #b19cd9;
            border-radius: 15px;
            padding: 1rem 1.5rem;
            color: #ffffff;
            font-size: 1.1rem;
            text-align: center;
            z-index: 100;
            width: 280px;
            box-shadow: 0 0 25px rgba(177, 156, 217, 0.5);
            opacity: 0;
            animation: pulse 2s infinite, fadeIn 1s forwards 1s;
        }
        
        .core-guide:after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 10px solid transparent;
            border-right: 10px solid transparent;
            border-top: 10px solid #b19cd9;
        }
        
        .core-guide .guide-text {
            margin-bottom: 10px;
            color: #d8b2ff;
            font-weight: 500;
        }
        
        .core-guide .dismiss-btn {
            background: rgba(177, 156, 217, 0.3);
            border: 1px solid #b19cd9;
            color: #ffffff;
            border-radius: 15px;
            padding: 5px 15px;
            cursor: pointer;
            font-family: inherit;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            margin-top: 10px;
        }
        
        .core-guide .dismiss-btn:hover {
            background: rgba(177, 156, 217, 0.5);
            transform: translateY(-2px);
        }
        
        @keyframes fadeIn {
            from {opacity: 0;}
            to {opacity: 1;}
        }
        
        @keyframes pulse {
            0% {box-shadow: 0 0 25px rgba(177, 156, 217, 0.5);}
            50% {box-shadow: 0 0 40px rgba(177, 156, 217, 0.8);}
            100% {box-shadow: 0 0 25px rgba(177, 156, 217, 0.5);}
        }

        .milky-way-dust {
            position: absolute;
            width: 100%;
            height: 100%;
            background: radial-gradient(ellipse at center, rgba(255, 255, 255, 0.1) 0%, transparent 70%);
            pointer-events: none;
        }

        /* Time Jump Overlay Styles */
        .time-jump-starfield {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
        }
        
        .time-jump-star {
            position: absolute;
            background: white;
            border-radius: 50%;
            z-index: 1;
        }
        
        .time-vortex {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 100vh;
            height: 100vh;
            background: radial-gradient(
                circle at center,
                rgba(155, 89, 182, 0.1) 0%,
                rgba(155, 89, 182, 0.05) 20%,
                transparent 70%
            );
            border-radius: 50%;
            z-index: 1;
            animation: vortexPulse 4s infinite linear;
            opacity: 0;
        }
        
        @keyframes vortexPulse {
            0%, 100% { transform: translate(-50%, -50%) scale(1); }
            50% { transform: translate(-50%, -50%) scale(1.2); }
        }
        
        .time-jump-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            z-index: 10;
            font-family: 'JetBrains Mono', monospace;
            color: #ffffff;
            width: 100%;
            pointer-events: none;
        }
        
        .time-jump-header {
            color: #d8b2ff;
            font-size: 1.5rem;
            margin-bottom: 1rem;
            text-shadow: 0 0 10px rgba(216, 178, 255, 0.8);
            opacity: 0;
            transform: translateY(20px);
            animation: fadeInUp 1s forwards 0.5s;
        }
        
        .time-jump-year {
            font-size: 3rem;
            margin-bottom: 1.5rem;
            text-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
            opacity: 0;
            transform: translateY(20px);
            animation: fadeInUp 1s forwards 0.8s, glowPulse 2s infinite 1s;
        }
        
        @keyframes glowPulse {
            0%, 100% { text-shadow: 0 0 20px rgba(255, 255, 255, 0.5); }
            50% { text-shadow: 0 0 30px rgba(216, 178, 255, 0.9); }
        }
        
        .time-jump-loading {
            font-size: 1rem;
            color: #9b59b6;
            margin-top: 1.5rem;
            opacity: 0;
            transform: translateY(20px);
            animation: fadeInUp 1s forwards 1.1s;
        }
        
        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .loading-dots::after {
            content: '';
            animation: loadingDots 1.5s infinite steps(4, end);
        }
        
        @keyframes loadingDots {
            0% { content: ''; }
            25% { content: '.'; }
            50% { content: '..'; }
            75% { content: '...'; }
            100% { content: ''; }
        }
        
        .shooting-star {
            position: absolute;
            height: 2px;
            background: linear-gradient(to right, rgba(255,255,255,0) 0%, rgba(255,255,255,1) 50%, rgba(255,255,255,0) 100%);
            opacity: 0;
            z-index: 2;
            transform-origin: left center;
        }
        
        .time-streak {
            position: absolute;
            height: 2px;
            background: linear-gradient(to right, rgba(216,178,255,0) 0%, rgba(216,178,255,1) 50%, rgba(216,178,255,0) 100%);
            opacity: 0;
            z-index: 2;
            transform-origin: center;
        }
        
        .time-particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: #d8b2ff;
            border-radius: 50%;
            z-index: 3;
            box-shadow: 0 0 6px 2px rgba(216,178,255,0.8);
            opacity: 0;
        }

        /* Inbox Modal Styles */
        .inbox-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(26, 11, 46, 0.8);
            backdrop-filter: blur(10px);
            z-index: 2000;
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.5s ease;
        }

        .inbox-modal.active {
            opacity: 1;
            pointer-events: auto;
        }

        .inbox-modal-content {
            background: linear-gradient(145deg, rgba(177, 156, 217, 0.25), rgba(155, 89, 182, 0.25));
            border: 2px solid #b19cd9;
            border-radius: 20px;
            padding: 2.5rem;
            max-width: 90%;
            width: 800px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 10px 50px rgba(177, 156, 217, 0.5);
            backdrop-filter: blur(15px);
            transform: translateY(30px) scale(0.95);
            opacity: 0;
            transition: all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
            position: relative;
        }

        .inbox-modal.active .inbox-modal-content {
            transform: translateY(0) scale(1);
            opacity: 1;
        }

        .inbox-modal-header {
            text-align: center;
            margin-bottom: 2rem;
            position: sticky;
            top: 0;
            padding: 1rem 0;
            background: rgba(26, 11, 46, 0.5);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            z-index: 10;
        }

        .inbox-modal-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            width: 30px;
            height: 30px;
            border: 2px solid #b19cd9;
            border-radius: 50%;
            background: transparent;
            color: #b19cd9;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .inbox-modal-close:hover {
            background: rgba(177, 156, 217, 0.3);
            transform: rotate(90deg);
        }
        
        .capsule-list {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }
        
        .capsule-item {
            padding: 1.5rem;
            border-radius: 15px;
            border: 1px solid rgba(177, 156, 217, 0.3);
            background: rgba(26, 11, 46, 0.3);
            transition: all 0.3s ease;
        }
        
        .capsule-item:hover {
            background: rgba(26, 11, 46, 0.5);
            transform: translateY(-3px);
            box-shadow: 0 5px 20px rgba(155, 89, 182, 0.2);
        }
        
        /* Profile Styles */
        .profile-content {
            padding: 1.5rem;
        }
        
        .profile-info {
            background: rgba(26, 11, 46, 0.5);
            border-radius: 15px;
            padding: 2rem;
            border: 1px solid rgba(177, 156, 217, 0.3);
        }
        
        .profile-info h3 {
            color: #d8b2ff;
            font-size: 1.5rem;
            margin-bottom: 1.5rem;
            text-align: center;
        }
        
        .profile-field {
            margin-bottom: 1.2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid rgba(177, 156, 217, 0.2);
            display: flex;
            justify-content: space-between;
        }
        
        .field-label {
            font-weight: 500;
            color: #b19cd9;
        }
        
        .field-value {
            color: #ffffff;
        }
        
        .profile-actions {
            margin-top: 2rem;
            display: flex;
            justify-content: center;
        }
        
        .capsule-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid rgba(177, 156, 217, 0.2);
        }
        
        .capsule-date {
            font-size: 0.9rem;
            color: #b19cd9;
        }
        
        .capsule-message {
            margin: 1rem 0;
            color: #e1d4ff;
            font-size: 1.1rem;
            line-height: 1.6;
        }
        
        .capsule-media {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .capsule-media img {
            max-width: 100%;
            max-height: 200px;
            border-radius: 10px;
            object-fit: cover;
        }
        
        .capsule-media audio, .capsule-media video {
            max-width: 100%;
            border-radius: 10px;
        }
        
        .no-capsules {
            text-align: center;
            padding: 3rem 1rem;
            color: #b19cd9;
            font-style: italic;
        }
    </style>
</head>
<body>
    <canvas id="galaxy-canvas"></canvas>

    <!-- User Navigation with Profile and Inbox buttons -->
    <div class="user-nav">
        <a href="profile.html" class="cosmic-btn">Profile</a>
        <a href="inbox.html" class="cosmic-btn">Inbox</a>
        <button class="cosmic-btn" id="logoutBtn">Logout</button>
    </div>

    <!-- Login Modal -->
    <div class="auth-modal" id="loginModal">
        <div class="auth-modal-content">
            <button class="auth-modal-close" id="closeLoginModal">×</button>
            <div class="auth-modal-header">
                <h2>Welcome Back, Explorer</h2>
            </div>
            <form class="auth-form" id="loginForm">
                <div class="auth-input-group">
                    <label for="loginEmail">Email</label>
                    <input type="email" id="loginEmail" required>
                </div>
                <div class="auth-input-group">
                    <label for="loginPassword">Password</label>
                    <input type="password" id="loginPassword" required>
                </div>
                <button type="submit" class="auth-submit-btn">Login to Galaxy</button>
                <div class="auth-switch">
                    Don't have an account? <a href="#" id="switchToSignup">Join the expedition</a>
                </div>
            </form>
        </div>
    </div>

    <!-- Signup Modal -->
    <div class="auth-modal" id="signupModal">
        <div class="auth-modal-content">
            <button class="auth-modal-close" id="closeSignupModal">×</button>
            <div class="auth-modal-header">
                <h2>Join the Cosmic Journey</h2>
            </div>
            <form class="auth-form" id="signupForm">
                <div class="auth-input-group">
                    <label for="signupName">Explorer Name</label>
                    <input type="text" id="signupName" required>
                </div>
                <div class="auth-input-group">
                    <label for="signupEmail">Email</label>
                    <input type="email" id="signupEmail" required>
                </div>
                <div class="auth-input-group">
                    <label for="signupPassword">Password</label>
                    <input type="password" id="signupPassword" required>
                </div>
                <div class="auth-input-group">
                    <label for="signupConfirmPassword">Confirm Password</label>
                    <input type="password" id="signupConfirmPassword" required>
                </div>
                <button type="submit" class="auth-submit-btn">Begin Exploration</button>
                <div class="auth-switch">
                    Already exploring? <a href="#" id="switchToLogin">Login here</a>
                </div>
            </form>
        </div>
    </div>

    <!-- Custom Popup -->
    <div class="popup-overlay" id="welcomePopup">
        <div class="popup-content">
            <button class="popup-close" id="closePopup">×</button>
            <div class="popup-header">
                <div class="popup-icon">✨</div>
                <h2>Welcome to Time Capsule</h2>
            </div>
            <div class="popup-body">
                <p>You've discovered the center of our digital galaxy! This is where memories are stored and preserved across time and space. Create your own capsule to save special moments that can be unlocked in the future.</p>
            </div>
            <div class="popup-actions">
                <button class="popup-btn" id="exploreBtn">Explore the Galaxy</button>
                <button class="popup-btn" id="createCapsuleBtn">Create a Capsule</button>
            </div>
        </div>
    </div>

    <!-- Year Selector Popup -->
    <div class="year-selector-overlay" id="yearSelectorPopup">
        <div class="year-selector-content">
            <div class="year-selector-header">
                <h3>Select a Year</h3>
            </div>
            <input type="number" id="yearInput" class="year-input" placeholder="Enter year (e.g., 2025)" />
            <div class="year-validation-error" id="yearValidationError">Please enter a valid year!</div>
            <div class="year-selector-actions">
                <button class="year-selector-btn" id="confirmYearBtn">Confirm Year</button>
                <button class="year-selector-btn" id="closeYearSelectorBtn">Close</button>
            </div>
        </div>
    </div>

    <!-- Profile Modal -->
    <div class="inbox-modal" id="profileModal">
        <div class="inbox-modal-content">
            <button class="inbox-modal-close" id="closeProfileModal">×</button>
            <div class="inbox-modal-header">
                <h2>Your Profile</h2>
            </div>
            <div class="profile-content">
                <!-- Profile content will be loaded here -->
                <div class="profile-info">
                    <h3>Explorer Information</h3>
                    <div class="profile-field">
                        <span class="field-label">Name:</span>
                        <span class="field-value" id="profileName">Loading...</span>
                    </div>
                    <div class="profile-field">
                        <span class="field-label">Email:</span>
                        <span class="field-value" id="profileEmail">Loading...</span>
                    </div>
                    <div class="profile-field">
                        <span class="field-label">Time Traveler Level:</span>
                        <span class="field-value">Novice Explorer</span>
                    </div>
                    <div class="profile-actions">
                        <button class="cosmic-btn" id="editProfileBtn">Edit Profile</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Inbox Modal -->
    <div class="inbox-modal" id="inboxModal">
        <div class="inbox-modal-content">
            <button class="inbox-modal-close" id="closeInboxModal">×</button>
            <div class="inbox-modal-header">
                <h2>Your Time Capsules</h2>
            </div>
            <div class="capsule-list" id="capsuleList">
                <!-- Capsules will be loaded here -->
                <div class="no-capsules">Loading your time capsules...</div>
            </div>
        </div>
    </div>

    <!-- Galaxy Core Guide Popup -->
    <div class="core-guide" id="coreGuide">
        <div class="guide-text">Click on the galaxy core to discover more!</div>
        <button class="dismiss-btn" id="dismissGuideBtn">Got it</button>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded, starting script...');
            
            // Mouse interaction variables
            let mouseX = 0, mouseY = 0;

            // Check if we're coming from a transition
            const isTransitioning = !!sessionStorage.getItem('cameraState');
            
            // Create transition overlay if coming from landing page
            let transitionOverlay;
            if (isTransitioning) {
                transitionOverlay = document.createElement('div');
                transitionOverlay.style.position = 'fixed';
                transitionOverlay.style.top = '0';
                transitionOverlay.style.left = '0';
                transitionOverlay.style.width = '100%';
                transitionOverlay.style.height = '100%';
                transitionOverlay.style.backgroundColor = '#1a0b2e';
                transitionOverlay.style.opacity = '1';
                transitionOverlay.style.zIndex = '9999';
                transitionOverlay.style.transition = 'opacity 2s ease-out';
                document.body.appendChild(transitionOverlay);
            }

            // Three.js Milky Way Galaxy Background
            console.log('Initializing Three.js...');
            const scene = new THREE.Scene();
            const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 3000);
            
            const canvas = document.getElementById('galaxy-canvas');
            if (!canvas) {
                console.error('Canvas element not found!');
                return;
            }
            
            const renderer = new THREE.WebGLRenderer({ 
                canvas: canvas, 
                alpha: true,
                antialias: true
            });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setClearColor(0x1a0b2e, 1);
            
            console.log('Three.js initialized successfully');

        // Create realistic Milky Way galaxy structure
        const galaxyGroup = new THREE.Group();
        
        // Central bulge
        const bulgeGeometry = new THREE.BufferGeometry();
        const bulgeCount = 3000;
        const bulgePositions = new Float32Array(bulgeCount * 3);
        const bulgeColors = new Float32Array(bulgeCount * 3);
        const bulgeSizes = new Float32Array(bulgeCount);

        for (let i = 0; i < bulgeCount; i++) {
            const i3 = i * 3;
            const radius = Math.random() * 30;
            const theta = Math.random() * Math.PI * 2;
            const phi = Math.random() * Math.PI;
            
            bulgePositions[i3] = radius * Math.sin(phi) * Math.cos(theta);
            bulgePositions[i3 + 1] = radius * Math.sin(phi) * Math.sin(theta) * 0.3;
            bulgePositions[i3 + 2] = radius * Math.cos(phi);
            
            // Lavender and purple colors for the bulge
            const intensity = 0.8 + Math.random() * 0.2;
            bulgeColors[i3] = intensity * 0.9;     // Red component (lavender/purple)
            bulgeColors[i3 + 1] = intensity * 0.7; // Green component
            bulgeColors[i3 + 2] = intensity;       // Blue component (strongest for purple)
            
            bulgeSizes[i] = Math.random() * 3 + 2;
        }

        bulgeGeometry.setAttribute('position', new THREE.BufferAttribute(bulgePositions, 3));
        bulgeGeometry.setAttribute('color', new THREE.BufferAttribute(bulgeColors, 3));
        bulgeGeometry.setAttribute('size', new THREE.BufferAttribute(bulgeSizes, 1));

        const bulgeMaterial = new THREE.PointsMaterial({
            size: 1.5,
            sizeAttenuation: true,
            depthWrite: false,
            blending: THREE.AdditiveBlending,
            vertexColors: true
        });

        const bulge = new THREE.Points(bulgeGeometry, bulgeMaterial);
        galaxyGroup.add(bulge);

        // Spiral arms
        const spiralGeometry = new THREE.BufferGeometry();
        const spiralCount = 12000;
        const spiralPositions = new Float32Array(spiralCount * 3);
        const spiralColors = new Float32Array(spiralCount * 3);
        const spiralSizes = new Float32Array(spiralCount);

        const arms = 4;
        const maxRadius = 400;
        const spiralTightness = 2.5;

        for (let i = 0; i < spiralCount; i++) {
            const i3 = i * 3;
            
            // Determine which arm
            const armIndex = i % arms;
            const armOffset = (armIndex / arms) * Math.PI * 2;
            
            // Distance from center
            const radius = 30 + Math.pow(Math.random(), 0.8) * (maxRadius - 30);
            
            // Spiral angle
            const spiralAngle = armOffset + (radius / maxRadius) * Math.PI * spiralTightness;
            
            // Add some randomness
            const randomness = 20 + (radius / maxRadius) * 50;
            const randomX = (Math.random() - 0.5) * randomness;
            const randomY = (Math.random() - 0.5) * randomness * 0.1;
            const randomZ = (Math.random() - 0.5) * randomness;
            
            spiralPositions[i3] = Math.cos(spiralAngle) * radius + randomX;
            spiralPositions[i3 + 1] = randomY;
            spiralPositions[i3 + 2] = Math.sin(spiralAngle) * radius + randomZ;
            
            // Color based on distance and arm
            const distanceFactor = 1 - (radius / maxRadius);
            const armBrightness = 0.3 + Math.random() * 0.7;
            
            if (armIndex === 0 || armIndex === 2) {
                // Deeper purple arms
                spiralColors[i3] = armBrightness * 0.8;
                spiralColors[i3 + 1] = armBrightness * 0.5;
                spiralColors[i3 + 2] = armBrightness;
            } else {
                // Lavender arms
                spiralColors[i3] = armBrightness;
                spiralColors[i3 + 1] = armBrightness * 0.8;
                spiralColors[i3 + 2] = armBrightness;
            }
            
            spiralSizes[i] = Math.random() * 2 + 0.5;
        }

        spiralGeometry.setAttribute('position', new THREE.BufferAttribute(spiralPositions, 3));
        spiralGeometry.setAttribute('color', new THREE.BufferAttribute(spiralColors, 3));
        spiralGeometry.setAttribute('size', new THREE.BufferAttribute(spiralSizes, 1));

        const spiralMaterial = new THREE.PointsMaterial({
            size: 0.8,
            sizeAttenuation: true,
            depthWrite: false,
            blending: THREE.AdditiveBlending,
            vertexColors: true
        });

        const spiral = new THREE.Points(spiralGeometry, spiralMaterial);
        galaxyGroup.add(spiral);

        // Dust lanes
        const dustGeometry = new THREE.BufferGeometry();
        const dustCount = 5000;
        const dustPositions = new Float32Array(dustCount * 3);
        const dustColors = new Float32Array(dustCount * 3);

        for (let i = 0; i < dustCount; i++) {
            const i3 = i * 3;
            const radius = 50 + Math.random() * 300;
            const angle = Math.random() * Math.PI * 2;
            
            dustPositions[i3] = Math.cos(angle) * radius + (Math.random() - 0.5) * 100;
            dustPositions[i3 + 1] = (Math.random() - 0.5) * 5;
            dustPositions[i3 + 2] = Math.sin(angle) * radius + (Math.random() - 0.5) * 100;
            
            // Dark purple colors for dust
            const darkness = Math.random() * 0.4;
            dustColors[i3] = darkness * 0.9;
            dustColors[i3 + 1] = darkness * 0.6;
            dustColors[i3 + 2] = darkness;
        }

        dustGeometry.setAttribute('position', new THREE.BufferAttribute(dustPositions, 3));
        dustGeometry.setAttribute('color', new THREE.BufferAttribute(dustColors, 3));

        const dustMaterial = new THREE.PointsMaterial({
            size: 3,
            sizeAttenuation: true,
            depthWrite: false,
            blending: THREE.AdditiveBlending,
            vertexColors: true,
            opacity: 0.6,
            transparent: true
        });

        const dust = new THREE.Points(dustGeometry, dustMaterial);
        galaxyGroup.add(dust);

        // Background stars
        const starsGeometry = new THREE.BufferGeometry();
        const starsCount = 8000;
        const starsPositions = new Float32Array(starsCount * 3);
        const starsColors = new Float32Array(starsCount * 3);

        for (let i = 0; i < starsCount; i++) {
            const i3 = i * 3;
            starsPositions[i3] = (Math.random() - 0.5) * 2000;
            starsPositions[i3 + 1] = (Math.random() - 0.5) * 2000;
            starsPositions[i3 + 2] = (Math.random() - 0.5) * 2000;
            
            // Various star colors with purple tints
            const starType = Math.random();
            if (starType < 0.5) {
                // Lavender/white stars
                starsColors[i3] = 0.9 + Math.random() * 0.1;
                starsColors[i3 + 1] = 0.8 + Math.random() * 0.2;
                starsColors[i3 + 2] = 1;
            } else if (starType < 0.8) {
                // Purple stars
                starsColors[i3] = 0.8 + Math.random() * 0.2;
                starsColors[i3 + 1] = 0.5 + Math.random() * 0.3;
                starsColors[i3 + 2] = 1;
            } else {
                // Deep purple stars
                starsColors[i3] = 0.6 + Math.random() * 0.2;
                starsColors[i3 + 1] = 0.3 + Math.random() * 0.3;
                starsColors[i3 + 2] = 0.8 + Math.random() * 0.2;
            }
        }

        starsGeometry.setAttribute('position', new THREE.BufferAttribute(starsPositions, 3));
        starsGeometry.setAttribute('color', new THREE.BufferAttribute(starsColors, 3));

        const starsMaterial = new THREE.PointsMaterial({
            size: 0.5,
            sizeAttenuation: true,
            depthWrite: false,
            blending: THREE.AdditiveBlending,
            vertexColors: true
        });

        const stars = new THREE.Points(starsGeometry, starsMaterial);
        scene.add(stars);

        scene.add(galaxyGroup);        // Create an invisible hitbox for the galaxy core
        const coreRadius = 30;
        const coreHitboxGeometry = new THREE.SphereGeometry(coreRadius, 32, 32);
        const coreHitboxMaterial = new THREE.MeshBasicMaterial({
            transparent: true,
            opacity: 0,
            depthWrite: false
        });
        const clickableCore = new THREE.Mesh(coreHitboxGeometry, coreHitboxMaterial);
        clickableCore.position.set(0, 0, 0);
        clickableCore.name = "clickableCore";
        galaxyGroup.add(clickableCore);
        
        // Add subtle glow to the core (just enhancing what's already there)
        const coreLight = new THREE.PointLight(0xb19cd9, 1.2, 150);
        coreLight.position.set(0, 0, 0);
        galaxyGroup.add(coreLight);

        // Camera positioning
        if (isTransitioning) {
            // Retrieve camera state from transition
            const cameraState = JSON.parse(sessionStorage.getItem('cameraState'));
            camera.position.set(
                cameraState.position.x,
                cameraState.position.y,
                cameraState.position.z
            );
            camera.rotation.x = cameraState.rotation.x;
            camera.rotation.y = cameraState.rotation.y;
            camera.rotation.z = cameraState.rotation.z;
            
            // Clear the stored state after using it
            sessionStorage.removeItem('cameraState');
            
            // Gradually move camera to normal position
            gsap.to(camera.position, {
                x: 0,
                y: 100,
                z: 500,
                duration: 5,
                ease: "power1.out",
                onUpdate: () => {
                    camera.updateProjectionMatrix();
                },
                onStart: () => {
                    // Fade out the transition overlay
                    if (transitionOverlay) {
                        setTimeout(() => {
                            transitionOverlay.style.opacity = '0';
                            setTimeout(() => {
                                transitionOverlay.remove();
                            }, 2000);
                        }, 500);
                    }
                }
            });
            
            // Gradually reset camera rotation
            gsap.to(camera.rotation, {
                x: 0,
                y: 0,
                z: 0,
                duration: 5,
                ease: "power1.out"
            });
        } else {
            // Default camera position for direct access
            camera.position.set(0, 100, 500);
            camera.lookAt(0, 0, 0);
        }

        document.addEventListener('mousemove', (event) => {
            mouseX = (event.clientX / window.innerWidth) * 2 - 1;
            mouseY = -(event.clientY / window.innerHeight) * 2 + 1;
        });

        // Raycaster for ball interactions
        const raycaster = new THREE.Raycaster();
        const mouse = new THREE.Vector2();
          // Handle click events
        document.addEventListener('click', (event) => {
            // Update mouse position for raycaster
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;
            
            // Cast ray
            raycaster.setFromCamera(mouse, camera);
            const intersects = raycaster.intersectObjects([clickableCore]);
              // If galaxy core is clicked
            if (intersects.length > 0) {
                // Temporarily increase core light intensity for visual feedback
                const originalIntensity = coreLight.intensity;
                const originalDistance = coreLight.distance;
                gsap.to(coreLight, {
                    intensity: 2.5,
                    distance: 200,
                    duration: 0.3,
                    onComplete: () => {
                        gsap.to(coreLight, {
                            intensity: originalIntensity,
                            distance: originalDistance,
                            duration: 0.6,
                            ease: "elastic.out"
                        });
                    }
                });
                
                // Emit particles on click
                createExplosion(clickableCore.position, 80);
                
                // Show the popup with animation
                const welcomePopup = document.getElementById('welcomePopup');
                welcomePopup.classList.add('active');
                
                // Add animation to the popup content
                const popupContent = welcomePopup.querySelector('.popup-content');
                gsap.fromTo(popupContent, 
                    { y: 30, opacity: 0, scale: 0.95 },
                    { y: 0, opacity: 1, scale: 1, duration: 0.5, ease: "back.out(1.7)" }
                );
                
                // Hide and disable the core guide popup
                const coreGuide = document.getElementById('coreGuide');
                if (coreGuide) {
                    // Animate out the guide popup
                    gsap.to(coreGuide, {
                        opacity: 0,
                        y: -20,
                        scale: 0.9,
                        duration: 0.3,
                        onComplete: () => {
                            coreGuide.style.display = 'none';
                        }
                    });
                    
                    // Save to localStorage so it doesn't show again
                    localStorage.setItem('hasSeenCoreGuide', 'true');
                    // Also mark that the user has interacted with the core
                    localStorage.setItem('hasInteractedWithCore', 'true');
                }
            }
        });

        // Create particle explosion effect
        function createExplosion(position, particleCount) {
            const explosionGeometry = new THREE.BufferGeometry();
            const explosionPositions = new Float32Array(particleCount * 3);
            const explosionColors = new Float32Array(particleCount * 3);
            
            for (let i = 0; i < particleCount; i++) {
                const i3 = i * 3;
                explosionPositions[i3] = position.x;
                explosionPositions[i3 + 1] = position.y;
                explosionPositions[i3 + 2] = position.z;
                
                // Particles in lavender/purple colors
                explosionColors[i3] = 0.8 + Math.random() * 0.2;
                explosionColors[i3 + 1] = 0.6 + Math.random() * 0.3;
                explosionColors[i3 + 2] = 0.9 + Math.random() * 0.1;
            }
            
            explosionGeometry.setAttribute('position', new THREE.BufferAttribute(explosionPositions, 3));
            explosionGeometry.setAttribute('color', new THREE.BufferAttribute(explosionColors, 3));
            
            const explosionMaterial = new THREE.PointsMaterial({
                size: 3,
                color: 0xb19cd9,
                transparent: true,
                depthWrite: false,
                blending: THREE.AdditiveBlending,
                vertexColors: true
            });
            
            const explosion = new THREE.Points(explosionGeometry, explosionMaterial);
            scene.add(explosion);
            
            // Animate particles outward
            const positionAttribute = explosionGeometry.getAttribute('position');
            
            // Create random velocities for each particle
            const velocities = [];
            for (let i = 0; i < particleCount; i++) {
                velocities.push(new THREE.Vector3(
                    (Math.random() - 0.5) * 3,
                    (Math.random() - 0.5) * 3,
                    (Math.random() - 0.5) * 3
                ));
            }
            
            // Animation
            gsap.to(explosionMaterial, {
                opacity: 0,
                duration: 2,
                onUpdate: () => {
                    // Update positions based on velocities
                    for (let i = 0; i < particleCount; i++) {
                        const i3 = i * 3;
                        positionAttribute.array[i3] += velocities[i].x;
                        positionAttribute.array[i3 + 1] += velocities[i].y;
                        positionAttribute.array[i3 + 2] += velocities[i].z;
                    }
                    positionAttribute.needsUpdate = true;
                },
                onComplete: () => {
                    scene.remove(explosion);
                    explosion.geometry.dispose();
                    explosion.material.dispose();
                }
            });
        }        // Update core appearance on hover
        let isHovering = false;
        document.addEventListener('mousemove', (event) => {
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;
            
            // Update the picking ray with the camera and mouse position
            raycaster.setFromCamera(mouse, camera);
            
            // Calculate objects intersecting the picking ray
            const intersects = raycaster.intersectObjects([clickableCore]);
            
            // Change cursor and enhance core appearance on hover
            if (intersects.length > 0) {
                if (!isHovering) {
                    isHovering = true;
                    document.body.style.cursor = 'pointer';
                    gsap.to(coreLight, { intensity: 1.8, distance: 180, duration: 0.3 });
                    
                    // Slightly brighten the central bulge particles
                    gsap.to(bulgeMaterial, { size: 2, duration: 0.3 });
                }
            } else {
                if (isHovering) {
                    isHovering = false;
                    document.body.style.cursor = 'auto';
                    gsap.to(coreLight, { intensity: 1.2, distance: 150, duration: 0.3 });
                    gsap.to(bulgeMaterial, { size: 1.5, duration: 0.3 });
                }
            }
        });

        // Animation loop
        function animate() {
            requestAnimationFrame(animate);
            
            // Rotate galaxy slowly
            galaxyGroup.rotation.y += 0.001;
            
            // Subtle mouse interaction
            galaxyGroup.rotation.x += (mouseY * 0.1 - galaxyGroup.rotation.x) * 0.05;
            galaxyGroup.rotation.z += (mouseX * 0.1 - galaxyGroup.rotation.z) * 0.05;
            
            // Rotate stars independently
            stars.rotation.y += 0.0005;
            stars.rotation.x += 0.0002;
            
            // Camera slight movement based on mouse
            camera.position.x += (mouseX * 20 - camera.position.x) * 0.01;
            camera.position.y += (mouseY * 20 - camera.position.y) * 0.01;
            
            renderer.render(scene, camera);
        }

        animate();

        // Handle window resize
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        // Year selector functionality
        function createYearSelector() {
            const yearSelectorPopup = document.getElementById('yearSelectorPopup');
            yearSelectorPopup.classList.add('active');
            
            // Animate year selector content
            const yearSelectorContent = yearSelectorPopup.querySelector('.year-selector-content');
            gsap.fromTo(yearSelectorContent, 
                { y: 30, opacity: 0, scale: 0.95 },
                { y: 0, opacity: 1, scale: 1, duration: 0.5, ease: "back.out(1.7)" }
            );
        }

        // Close year selector
        function closeYearSelector() {
            const yearSelectorPopup = document.getElementById('yearSelectorPopup');
            const yearSelectorContent = yearSelectorPopup.querySelector('.year-selector-content');
            
            // Animate out
            gsap.to(yearSelectorContent, {
                y: 30, 
                opacity: 0, 
                scale: 0.95, 
                duration: 0.3, 
                onComplete: () => {
                    yearSelectorPopup.classList.remove('active');
                }
            });
        }

        // Validate year input
        function validateYear(year) {
            const currentYear = new Date().getFullYear();
            return year >= 1900 && year <= currentYear + 10;
        }

        // Year input confirmation
        document.getElementById('confirmYearBtn').addEventListener('click', () => {
            const yearInput = document.getElementById('yearInput');
            const yearValidationError = document.getElementById('yearValidationError');
            
            const year = parseInt(yearInput.value);
            
            // Check if year is valid
            if (!validateYear(year)) {
                yearValidationError.style.display = 'block';
                return;
            } else {
                yearValidationError.style.display = 'none';
            }
            
            // Close year selector
            closeYearSelector();
            
            // Here you can add the code to handle the selected year (e.g., navigate to a different page or load content)
            console.log('Selected year:', year);

            // Create a special effect for time travel to the selected year
            createTimeTravelEffect(year);
        });

        // Close year selector on button click
        document.getElementById('closeYearSelectorBtn').addEventListener('click', () => {
            closeYearSelector();
        });

        // Create time travel effect
        function createTimeTravelEffect(year) {
            // Calculate the decade folder name and possible file names
            const decade = Math.floor(year / 10) * 10;
            const decadeFolderName = `${decade}`; // Just the decade number, no 's'
            
            // Create a full-screen overlay with enhanced cosmic effects
            const timeJumpOverlay = document.createElement('div');
            timeJumpOverlay.style.position = 'fixed';
            timeJumpOverlay.style.top = '0';
            timeJumpOverlay.style.left = '0';
            timeJumpOverlay.style.width = '100%';
            timeJumpOverlay.style.height = '100%';
            timeJumpOverlay.style.backgroundColor = '#090413';
            timeJumpOverlay.style.zIndex = '2000';
            timeJumpOverlay.style.opacity = '0';
            timeJumpOverlay.style.overflow = 'hidden';
            
            // Add starfield and cosmic effects container
            timeJumpOverlay.innerHTML = `
                <div class="time-jump-starfield"></div>
                <div class="time-vortex"></div>
                <div class="time-jump-content">
                    <div class="time-jump-header">TIME JUMP INITIATED</div>
                    <div class="time-jump-year">TRAVELING TO YEAR ${year}</div>
                    <div class="time-jump-loading">
                        <span id="loadingText">Gathering historical data from the ${decade}s</span>
                        <span class="loading-dots"></span>
                    </div>
                </div>
            `;
            
            document.body.appendChild(timeJumpOverlay);
            
            // Animate the overlay appearing
            gsap.to(timeJumpOverlay, {
                opacity: 1,
                duration: 0.5,
                onComplete: () => {
                    // Activate the time vortex
                    const vortex = timeJumpOverlay.querySelector('.time-vortex');
                    if (vortex) {
                        vortex.style.opacity = '1';
                    }
                    
                    // Create cosmic effects
                    createCosmicEffects(timeJumpOverlay);
                    
                    // Update the loading text to reflect looking for archived content
                    const loadingText = document.getElementById('loadingText');
                    loadingText.textContent = `Searching time capsule archives for ${year}`;

                    // Check for files in the feed directory
                    const exactYearFile = `feed/${year}s.html`;       // For exact year e.g., 1973s.html (if it exists)
                    const decadeFile = `feed/${decade}s.html`;        // e.g., 1970s.html 
                    const alternateDecadeFile = `feed/${decade}s_new.html`; // e.g., 1960s_new.html
                    
                    // Order matters - we'll check them in priority order
                    const possibleFiles = [exactYearFile, decadeFile, alternateDecadeFile];
                    
                    // Function to check if a file exists
                    function checkFileExists(url) {
                        return new Promise((resolve) => {
                            fetch(url, { method: 'HEAD' })
                                .then(response => {
                                    if (response.ok) {
                                        resolve({ exists: true, url: url });
                                    } else {
                                        resolve({ exists: false });
                                    }
                                })
                                .catch(() => resolve({ exists: false }));
                        });
                    }
                    
                    // Check all possible files and use the first one that exists
                    Promise.all(possibleFiles.map(file => checkFileExists(file)))
                        .then(results => {
                            // Find the first file that exists
                            const foundFile = results.find(result => result.exists);
                            
                            // Update loading message based on result
                            if (foundFile && foundFile.exists) {
                                loadingText.textContent = `Time capsule archive found! Preparing ${year}s content...`;
                            } else {
                                loadingText.textContent = `Redirecting to decade explorer for ${decade}s...`;
                            }
                            
                            // After 3 seconds, redirect to appropriate page
                            setTimeout(() => {
                                // Fade out the overlay
                                gsap.to(timeJumpOverlay, {
                                    opacity: 0,
                                    duration: 1,
                                    onComplete: () => {
                                        // If a matching file was found in the feed directory, redirect to it
                                        if (foundFile && foundFile.exists) {
                                            window.location.href = foundFile.url;
                                        } else {
                                            // Otherwise, redirect to the decade folder's index.html
                                            window.location.href = `decades/${decadeFolderName}/index.html`;
                                        }
                                    }
                                });
                            }, 3000);
                        });
                }
            });
            
            // Add styles for the time jump elements
            const jumpStyle = document.createElement('style');
            jumpStyle.textContent = `
                .time-jump-starfield {
                    position: absolute;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    z-index: 0;
                }
                
                .time-jump-star {
                    position: absolute;
                    background: white;
                    border-radius: 50%;
                    z-index: 1;
                }
                
                .time-vortex {
                    position: absolute;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    width: 100vh;
                    height: 100vh;
                    background: radial-gradient(
                        circle at center,
                        rgba(155, 89, 182, 0.1) 0%,
                        rgba(155, 89, 182, 0.05) 20%,
                        transparent 70%
                    );
                    border-radius: 50%;
                    z-index: 1;
                    animation: vortexPulse 4s infinite linear;
                    opacity: 0;
                    transition: opacity 1s ease;
                }
            `;
            document.head.appendChild(jumpStyle);
        }
        
        // Create cosmic effects for time travel
        function createCosmicEffects(overlay) {
            // Create multiple shooting stars
            for (let i = 0; i < 8; i++) {
                setTimeout(() => {
                    createShootingStarInJump(overlay);
                }, i * 200);
            }
            
            // Create time streaks
            for (let i = 0; i < 5; i++) {
                setTimeout(() => {
                    createTimeStreakEffect(overlay);
                }, i * 300 + 500);
            }
            
            // Create floating particles
            for (let i = 0; i < 15; i++) {
                setTimeout(() => {
                    createFloatingParticle(overlay);
                }, i * 100 + 1000);
            }
        }
        
        // Create shooting stars in time jump
        function createShootingStarInJump(overlay) {
            const star = document.createElement('div');
            star.className = 'shooting-star';
            
            // Randomize position, size and angle
            const startX = Math.random() * 100;
            const startY = Math.random() * 60; // Keep in upper part of screen
            const length = 50 + Math.random() * 150;
            const angle = -15 - Math.random() * 40; // Angle downward
            const duration = 0.6 + Math.random() * 0.8;
            
            star.style.cssText = `
                left: ${startX}%;
                top: ${startY}%;
                width: ${length}px;
                transform: rotate(${angle}deg);
            `;
            
            overlay.appendChild(star);
            
            // Animate the shooting star
            gsap.fromTo(star, 
                { opacity: 0, x: 0 },
                { 
                    opacity: 1, 
                    x: length * 2,
                    duration: duration,
                    ease: "power1.in",
                    onComplete: () => {
                        gsap.to(star, {
                            opacity: 0,
                            duration: 0.3,
                            onComplete: () => {
                                if (overlay.contains(star)) {
                                    overlay.removeChild(star);
                                }
                            }
                        });
                    }
                }
            );
        }
        
        // Create horizontal time streak effect
        function createTimeStreakEffect(overlay) {
            const streak = document.createElement('div');
            streak.className = 'time-streak';
            
            // Always go through center, vary the angle slightly
            const angle = 90 + (Math.random() - 0.5) * 10; // Almost horizontal
            const length = 100 + Math.random() * 300;
            const thickness = 1 + Math.random() * 2;
            const speed = 0.5 + Math.random() * 0.5;
            
            streak.style.cssText = `
                left: 50%;
                top: 50%;
                width: ${length}px;
                height: ${thickness}px;
                transform: translate(-50%, -50%) rotate(${angle}deg);
            `;
            
            overlay.appendChild(streak);
            
            // Animate the time streak
            gsap.fromTo(streak,
                { opacity: 0, scaleX: 0 },
                { 
                    opacity: 0.7, 
                    scaleX: 1,
                    duration: speed,
                    ease: "power1.out",
                    onComplete: () => {
                        gsap.to(streak, {
                            opacity: 0,
                            duration: 0.3,
                            onComplete: () => {
                                if (overlay.contains(streak)) {
                                    overlay.removeChild(streak);
                                }
                            }
                        });
                    }
                }
            );
        }
        
        // Create floating particles
        function createFloatingParticle(overlay) {
            const particle = document.createElement('div');
            particle.className = 'time-particle';
            
            // Position near the center
            const centerDistance = Math.random() * 150;
            const angle = Math.random() * Math.PI * 2;
            const x = Math.cos(angle) * centerDistance + 50; // 50% is center
            const y = Math.sin(angle) * centerDistance + 50;
            
            // Random duration
            const duration = 2 + Math.random() * 3;
            
            particle.style.cssText = `
                left: ${x}%;
                top: ${y}%;
            `;
            
            overlay.appendChild(particle);
            
            // Animate floating movement
            const destX = x + (Math.random() - 0.5) * 20;
            const destY = y + (Math.random() - 0.5) * 20;
            
            gsap.fromTo(particle,
                { opacity: 0, scale: 0 },
                { 
                    opacity: 0.8, 
                    scale: 1,
                    duration: 0.5,
                    ease: "power1.out",
                    onComplete: () => {
                        gsap.to(particle, {
                            x: destX - x,
                            y: destY - y,
                            opacity: 0,
                            duration: duration,
                            ease: "power1.inOut",
                            onComplete: () => {
                                if (overlay.contains(particle)) {
                                    overlay.removeChild(particle);
                                }
                            }
                        });
                    }
                }
            );
        }

        // Popup functionality
        document.getElementById('closePopup').addEventListener('click', () => {
            const welcomePopup = document.getElementById('welcomePopup');
            const popupContent = welcomePopup.querySelector('.popup-content');
            
            // Animate out
            gsap.to(popupContent, {
                y: 30, 
                opacity: 0, 
                scale: 0.95, 
                duration: 0.3, 
                onComplete: () => {
                    welcomePopup.classList.remove('active');
                }
            });
        });
          document.getElementById('exploreBtn').addEventListener('click', () => {
            // Close popup
            document.getElementById('closePopup').click();
            
            // Move camera to explore the galaxy
            gsap.to(camera.position, {
                x: 100,
                y: 50,
                z: 300,
                duration: 2,
                ease: "power2.inOut"
            });
            
            // Rotate galaxy to showcase spiral arms
            gsap.to(galaxyGroup.rotation, {
                x: -0.3,
                y: Math.PI * 0.25,
                duration: 2,
                ease: "power2.inOut",
                onComplete: () => {
                    // After camera movement, show year input prompt
                    setTimeout(() => {
                        createYearSelector();
                    }, 500);
                }
            });
        });
          document.getElementById('createCapsuleBtn').addEventListener('click', () => {
            // Close popup
            document.getElementById('closePopup').click();
            
            // Create Big Bang effect - first zoom into the core
            gsap.to(camera.position, {
                x: 0,
                y: 0,
                z: 20,
                duration: 1.5,
                ease: "power2.in"
            });
            
            // Increase core light intensity dramatically
            gsap.to(coreLight, {
                intensity: 5,
                distance: 500,
                color: 0xffffff,
                duration: 1
            });
            
            // Create expanding explosion with many particles
            createExplosion(new THREE.Vector3(0, 0, 0), 500);
            
            // After zooming in, trigger second phase of the big bang
            setTimeout(() => {
                // Flash the screen white
                const flashOverlay = document.createElement('div');
                flashOverlay.style.position = 'fixed';
                flashOverlay.style.top = '0';
                flashOverlay.style.left = '0';
                flashOverlay.style.width = '100%';
                flashOverlay.style.height = '100%';
                flashOverlay.style.backgroundColor = 'white';
                flashOverlay.style.zIndex = '2000';
                flashOverlay.style.opacity = '0';
                document.body.appendChild(flashOverlay);
                
                // Flash and fade
                gsap.to(flashOverlay, {
                    opacity: 1,
                    duration: 0.2,
                    onComplete: () => {
                        // Create more explosions across the scene
                        for (let i = 0; i < 10; i++) {
                            const randomPos = new THREE.Vector3(
                                (Math.random() - 0.5) * 100,
                                (Math.random() - 0.5) * 100,
                                (Math.random() - 0.5) * 100
                            );
                            createExplosion(randomPos, 200);
                        }
                                  // Start fading out while navigating
                        gsap.to(flashOverlay, {
                            opacity: 0,
                            duration: 0.8,
                            delay: 0.2,
                            onComplete: () => {
                                document.body.removeChild(flashOverlay);
                                // Redirect to time-explorer with a delay
                                // Use the current year when creating a new capsule
                                const currentYear = new Date().getFullYear();
                                window.location.href = `time-explorer.html?year=${currentYear}`;
                            }
                        });
                    }
                });
            }, 1500);
        });
        
        // Authentication functionality
        document.getElementById('loginNavBtn').addEventListener('click', () => {
            const loginModal = document.getElementById('loginModal');
            loginModal.classList.add('active');
            
            // Clear the login form and reset button state
            document.getElementById('loginForm').reset();
            resetModalButtonStates('loginModal');
            
            // Animate modal content
            const modalContent = loginModal.querySelector('.auth-modal-content');
            gsap.fromTo(modalContent, 
                { y: 30, opacity: 0, scale: 0.95 },
                { y: 0, opacity: 1, scale: 1, duration: 0.5, ease: "back.out(1.7)" }
            );
        });

        document.getElementById('signupNavBtn').addEventListener('click', () => {
            const signupModal = document.getElementById('signupModal');
            signupModal.classList.add('active');
            
            // Clear the signup form and reset button state
            document.getElementById('signupForm').reset();
            resetModalButtonStates('signupModal');
            
            // Animate modal content
            const modalContent = signupModal.querySelector('.auth-modal-content');
            gsap.fromTo(modalContent, 
                { y: 30, opacity: 0, scale: 0.95 },
                { y: 0, opacity: 1, scale: 1, duration: 0.5, ease: "back.out(1.7)" }
            );
        });

        // Close modal functions
        function closeAuthModal(modalId) {
            const modal = document.getElementById(modalId);
            const modalContent = modal.querySelector('.auth-modal-content');
            
            // Reset button states before closing
            resetModalButtonStates(modalId);
            
            gsap.to(modalContent, {
                y: 30, 
                opacity: 0, 
                scale: 0.95, 
                duration: 0.3, 
                onComplete: () => {
                    modal.classList.remove('active');
                }
            });
        }

        // Reset button states in modals
        function resetModalButtonStates(modalId) {
            const modal = document.getElementById(modalId);
            const submitBtn = modal.querySelector('.auth-submit-btn');
            
            if (submitBtn) {
                submitBtn.disabled = false;
                
                // Reset button text based on modal type
                if (modalId === 'loginModal') {
                    submitBtn.textContent = 'Login to Galaxy';
                } else if (modalId === 'signupModal') {
                    submitBtn.textContent = 'Begin Exploration';
                }
            }
        }

        document.getElementById('closeLoginModal').addEventListener('click', () => {
            closeAuthModal('loginModal');
        });

        document.getElementById('closeSignupModal').addEventListener('click', () => {
            closeAuthModal('signupModal');
        });

        // Close modals when clicking outside
        document.getElementById('loginModal').addEventListener('click', (e) => {
            if (e.target.classList.contains('auth-modal')) {
                closeAuthModal('loginModal');
            }
        });

        document.getElementById('signupModal').addEventListener('click', (e) => {
            if (e.target.classList.contains('auth-modal')) {
                closeAuthModal('signupModal');
            }
        });

        // Close modals with Escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                const loginModal = document.getElementById('loginModal');
                const signupModal = document.getElementById('signupModal');
                
                if (loginModal.classList.contains('active')) {
                    closeAuthModal('loginModal');
                }
                if (signupModal.classList.contains('active')) {
                    closeAuthModal('signupModal');
                }
            }
        });

        // Switch between login and signup
        document.getElementById('switchToSignup').addEventListener('click', (e) => {
            e.preventDefault();
            closeAuthModal('loginModal');
            setTimeout(() => {
                document.getElementById('signupNavBtn').click();
            }, 400);
        });

        document.getElementById('switchToLogin').addEventListener('click', (e) => {
            e.preventDefault();
            closeAuthModal('signupModal');
            setTimeout(() => {
                document.getElementById('loginNavBtn').click();
            }, 400);
        });

        // Form submissions
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            // Basic validation
            if (!email || !password) {
                showCosmicMessage('Please fill in all fields', 'error');
                return;
            }
            
            try {
                // Show loading state
                const submitBtn = e.target.querySelector('.auth-submit-btn');
                const originalText = submitBtn.textContent;
                submitBtn.textContent = 'Logging in...';
                submitBtn.disabled = true;
                
                // Make API call to backend
                const response = await fetch('/api/auth/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ email, password })
                });
                
                let data;
                try {
                    data = await response.json();
                } catch (jsonError) {
                    console.error('JSON parse error:', jsonError);
                    throw new Error('Server response error. Please try again.');
                }
                
                if (response.ok && data.success) {
                    // Store token in localStorage
                    localStorage.setItem('token', data.token);
                    localStorage.setItem('user', JSON.stringify(data.user));
                    
                    // Create particle explosion for successful login
                    createExplosion(new THREE.Vector3(0, 0, 0), 50);
                    
                    // Close modal and show success
                    closeAuthModal('loginModal');
                    
                    // Update UI to show logged in state
                    updateAuthUI(data.user);
                    
                    // Clear form
                    document.getElementById('loginForm').reset();
                    
                    // Show cosmic success message
                    setTimeout(() => {
                        showCosmicMessage(`Welcome back, ${data.user.name}! 🚀`, 'success');
                    }, 500);
                } else {
                    // Handle error responses - use the message from the server
                    const errorMessage = data.message || data.error || `Error ${response.status}: ${response.statusText}`;
                    throw new Error(errorMessage);
                }
            } catch (error) {
                console.error('Login error:', error);
                
                // If it's a network error or JSON parsing error, show generic message
                if (error.name === 'SyntaxError' || error.message.includes('fetch')) {
                    showCosmicMessage('Connection error. Please check your internet connection.', 'error');
                } else {
                    showCosmicMessage(error.message || 'Login failed. Please try again.', 'error');
                }
            } finally {
                // Reset button state
                const submitBtn = e.target.querySelector('.auth-submit-btn');
                submitBtn.textContent = originalText;
                submitBtn.disabled = false;
            }
        });

        document.getElementById('signupForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const name = document.getElementById('signupName').value;
            const email = document.getElementById('signupEmail').value;
            const password = document.getElementById('signupPassword').value;
            const confirmPassword = document.getElementById('signupConfirmPassword').value;
            
            // Basic validation
            if (!name || !email || !password || !confirmPassword) {
                showCosmicMessage('Please fill in all fields', 'error');
                return;
            }
            
            if (password !== confirmPassword) {
                showCosmicMessage('Passwords do not match', 'error');
                return;
            }
            
            if (password.length < 6) {
                showCosmicMessage('Password must be at least 6 characters long', 'error');
                return;
            }
            
            try {
                // Show loading state
                const submitBtn = e.target.querySelector('.auth-submit-btn');
                const originalText = submitBtn.textContent;
                submitBtn.textContent = 'Creating account...';
                submitBtn.disabled = true;
                
                // Make API call to backend
                const response = await fetch('/api/auth/signup', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ name, email, password })
                });
                
                const data = await response.json();
                
                if (response.ok && data.success) {
                    // Store token in localStorage
                    localStorage.setItem('token', data.token);
                    localStorage.setItem('user', JSON.stringify(data.user));
                    
                    // Create particle explosion for successful signup
                    createExplosion(new THREE.Vector3(0, 0, 0), 80);
                    
                    // Close modal and show success
                    closeAuthModal('signupModal');
                    
                    // Update UI to show logged in state
                    updateAuthUI(data.user);
                    
                    // Clear form
                    document.getElementById('signupForm').reset();
                    
                    // Show cosmic success message
                    setTimeout(() => {
                        showCosmicMessage(`Welcome to the galaxy, ${data.user.name}! ✨`, 'success');
                    }, 500);
                } else {
                    throw new Error(data.message || data.error || 'Signup failed');
                }
            } catch (error) {
                console.error('Signup error:', error);
                const errorMessage = Array.isArray(error.message) ? error.message.join(', ') : error.message;
                showCosmicMessage(errorMessage || 'Signup failed. Please try again.', 'error');
            } finally {
                // Reset button state
                const submitBtn = e.target.querySelector('.auth-submit-btn');
                submitBtn.textContent = originalText;
                submitBtn.disabled = false;
            }
        });

        // Show cosmic success message
        function showCosmicMessage(message, type = 'success') {
            const messageEl = document.createElement('div');
            messageEl.style.position = 'fixed';
            messageEl.style.top = '20px';
            messageEl.style.left = '50%';
            messageEl.style.transform = 'translateX(-50%)';
            messageEl.style.background = type === 'error' 
                ? 'linear-gradient(145deg, rgba(255, 107, 157, 0.3), rgba(220, 20, 60, 0.3))'
                : 'linear-gradient(145deg, rgba(177, 156, 217, 0.3), rgba(155, 89, 182, 0.3))';
            messageEl.style.backdropFilter = 'blur(15px)';
            messageEl.style.border = type === 'error' ? '2px solid #ff6b9d' : '2px solid #b19cd9';
            messageEl.style.borderRadius = '20px';
            messageEl.style.padding = '1rem 2rem';
            messageEl.style.color = '#e1d4ff';
            messageEl.style.fontFamily = "'JetBrains Mono', monospace";
            messageEl.style.zIndex = '3000';
            messageEl.style.boxShadow = type === 'error' 
                ? '0 10px 30px rgba(255, 107, 157, 0.5)'
                : '0 10px 30px rgba(177, 156, 217, 0.5)';
            messageEl.style.opacity = '0';
            messageEl.style.transition = 'all 0.5s ease';
            messageEl.style.maxWidth = '400px';
            messageEl.style.textAlign = 'center';
            
            messageEl.textContent = message;
            document.body.appendChild(messageEl);
            
            // Animate in
            setTimeout(() => {
                messageEl.style.opacity = '1';
                messageEl.style.transform = 'translateX(-50%) translateY(10px)';
            }, 10);
            
            // Animate out after delay
            setTimeout(() => {
                messageEl.style.opacity = '0';
                messageEl.style.transform = 'translateX(-50%) translateY(-10px)';
                setTimeout(() => {
                    if (document.body.contains(messageEl)) {
                        document.body.removeChild(messageEl);
                    }
                }, 500);
            }, 4000);
        }

        // Update auth UI after login/signup
        function updateAuthUI(user) {
            const authNav = document.querySelector('.auth-nav');
            const userNav = document.querySelector('.user-nav');
            
            // Hide auth nav and show user nav
            authNav.style.display = 'none';
            userNav.style.display = 'flex';
            
            // Add event listeners for user nav buttons
            document.getElementById('viewProfileBtn').addEventListener('click', viewProfile);
            document.getElementById('inboxBtn').addEventListener('click', showInbox);
            document.getElementById('logoutBtn').addEventListener('click', logout);
        }

        // Logout function
        function logout() {
            localStorage.removeItem('token');
            localStorage.removeItem('user');
            
            // Hide user nav and show auth nav
            const authNav = document.querySelector('.auth-nav');
            const userNav = document.querySelector('.user-nav');
            authNav.style.display = 'flex';
            userNav.style.display = 'none';
            
            // Re-add event listeners
            document.getElementById('loginNavBtn').addEventListener('click', () => {
                const loginModal = document.getElementById('loginModal');
                loginModal.classList.add('active');
                
                // Clear the login form and reset button state
                document.getElementById('loginForm').reset();
                resetModalButtonStates('loginModal');
                
                const modalContent = loginModal.querySelector('.auth-modal-content');
                gsap.fromTo(modalContent, 
                    { y: 30, opacity: 0, scale: 0.95 },
                    { y: 0, opacity: 1, scale: 1, duration: 0.5, ease: "back.out(1.7)" }
                );
            });

            document.getElementById('signupNavBtn').addEventListener('click', () => {
                const signupModal = document.getElementById('signupModal');
                signupModal.classList.add('active');
                
                // Clear the signup form and reset button state
                document.getElementById('signupForm').reset();
                resetModalButtonStates('signupModal');
                
                const modalContent = signupModal.querySelector('.auth-modal-content');
                gsap.fromTo(modalContent, 
                    { y: 30, opacity: 0, scale: 0.95 },
                    { y: 0, opacity: 1, scale: 1, duration: 0.5, ease: "back.out(1.7)" }
                );
            });
            
            showCosmicMessage('Successfully logged out! 👋', 'success');
        }

        // View profile function
        function viewProfile() {
            const profileModal = document.getElementById('profileModal');
            profileModal.classList.add('active');
            
            // Animate modal content
            const modalContent = profileModal.querySelector('.inbox-modal-content');
            gsap.fromTo(modalContent,
                { y: 30, opacity: 0, scale: 0.95 },
                { y: 0, opacity: 1, scale: 1, duration: 0.5, ease: "back.out(1.7)" }
            );
            
            // Try to load user data from localStorage
            try {
                const userData = JSON.parse(localStorage.getItem('user'));
                if (userData) {
                    document.getElementById('profileName').textContent = userData.name || 'Anonymous Explorer';
                    document.getElementById('profileEmail').textContent = userData.email || 'Not available';
                }
            } catch (error) {
                console.error('Error loading user data:', error);
                document.getElementById('profileName').textContent = 'Anonymous Explorer';
                document.getElementById('profileEmail').textContent = 'Not available';
            }
        }

        // Show inbox function
        function showInbox() {
            const inboxModal = document.getElementById('inboxModal');
            inboxModal.classList.add('active');
            
            // Animate modal content
            const modalContent = inboxModal.querySelector('.inbox-modal-content');
            gsap.fromTo(modalContent,
                { y: 30, opacity: 0, scale: 0.95 },
                { y: 0, opacity: 1, scale: 1, duration: 0.5, ease: "back.out(1.7)" }
            );
            
            // Load capsules
            loadReceivedCapsules();
        }

        // Close profile modal
        document.getElementById('closeProfileModal').addEventListener('click', () => {
            const profileModal = document.getElementById('profileModal');
            const modalContent = profileModal.querySelector('.inbox-modal-content');
            
            // Animate out
            gsap.to(modalContent, {
                y: 30,
                opacity: 0,
                scale: 0.95,
                duration: 0.3,
                onComplete: () => {
                    profileModal.classList.remove('active');
                }
            });
        });
        
        // Close inbox modal
        document.getElementById('closeInboxModal').addEventListener('click', () => {
            const inboxModal = document.getElementById('inboxModal');
            const modalContent = inboxModal.querySelector('.inbox-modal-content');
            
            // Animate out
            gsap.to(modalContent, {
                y: 30,
                opacity: 0,
                scale: 0.95,
                duration: 0.3,
                onComplete: () => {
                    inboxModal.classList.remove('active');
                }
            });
        });

        // Load received capsules
        async function loadReceivedCapsules() {
            const capsuleList = document.getElementById('capsuleList');
            capsuleList.innerHTML = '<div class="no-capsules">Loading your time capsules...</div>';
            
            try {
                const user = JSON.parse(localStorage.getItem('user'));
                const token = localStorage.getItem('token');
                
                if (!user || !user.email || !token) {
                    capsuleList.innerHTML = '<div class="no-capsules">Please log in to view your capsules</div>';
                    return;
                }
                
                const response = await fetch(`/api/my-received-capsules?email=${encodeURIComponent(user.email)}`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                const data = await response.json();
                
                if (!response.ok) {
                    throw new Error(data.message || 'Failed to load capsules');
                }
                
                if (!data.capsules || data.capsules.length === 0) {
                    capsuleList.innerHTML = '<div class="no-capsules">No time capsules found. Check back later!</div>';
                    return;
                }
                
                // Display the capsules
                let capsulesHTML = '';
                data.capsules.forEach(capsule => {
                    const openDate = new Date(capsule.openDate).toLocaleDateString('en-US', {
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric'
                    });
                    
                    const createdDate = new Date(capsule.createdAt).toLocaleDateString('en-US', {
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric'
                    });
                    
                    let mediaHTML = '';
                    
                    if (capsule.imageFileUrl) {
                        mediaHTML += `<img src="${capsule.imageFileUrl}" alt="Time Capsule Image">`;
                    }
                    
                    if (capsule.audioFileUrl) {
                        mediaHTML += `
                            <audio controls>
                                <source src="${capsule.audioFileUrl}" type="audio/mpeg">
                                Your browser does not support the audio element.
                            </audio>
                        `;
                    }
                    
                    if (capsule.videoFileUrl) {
                        mediaHTML += `
                            <video width="320" height="240" controls>
                                <source src="${capsule.videoFileUrl}" type="video/mp4">
                                Your browser does not support the video element.
                            </video>
                        `;
                    }
                    
                    capsulesHTML += `
                        <div class="capsule-item">
                            <div class="capsule-header">
                                <div class="capsule-date">Opened: ${openDate}</div>
                                <div class="capsule-date">Created: ${createdDate}</div>
                            </div>
                            <div class="capsule-message">${capsule.message}</div>
                            ${mediaHTML ? `<div class="capsule-media">${mediaHTML}</div>` : ''}
                        </div>
                    `;
                });
                
                capsuleList.innerHTML = capsulesHTML;
                
            } catch (error) {
                console.error('Error loading capsules:', error);
                capsuleList.innerHTML = `<div class="no-capsules">Error: ${error.message || 'Failed to load capsules'}</div>`;
            }
        }

        // Check if user is already logged in
        function checkAuthStatus() {
            const token = localStorage.getItem('token');
            const user = localStorage.getItem('user');
            
            if (token && user) {
                try {
                    const userData = JSON.parse(user);
                    updateAuthUI(userData);
                } catch (error) {
                    console.error('Error parsing user data:', error);
                    localStorage.removeItem('token');
                    localStorage.removeItem('user');
                }
            }
        }

        // Check auth status on page load
        checkAuthStatus();
        
        // Handle core guide popup
        const coreGuide = document.getElementById('coreGuide');
        const dismissGuideBtn = document.getElementById('dismissGuideBtn');
        
        // Check if user has seen the guide or interacted with the core before
        const hasSeenGuide = localStorage.getItem('hasSeenCoreGuide');
        const hasInteractedWithCore = localStorage.getItem('hasInteractedWithCore');
        
        // Only show the guide if the user hasn't seen it or interacted with the core
        if (!hasSeenGuide && !hasInteractedWithCore) {
            // Show the guide if user hasn't seen it
            setTimeout(() => {
                coreGuide.style.display = 'block';
            }, 2000);
        } else {
            coreGuide.style.display = 'none';
        }
        
        // Handle dismiss button
        dismissGuideBtn.addEventListener('click', function() {
            // Animate the dismissal
            coreGuide.style.animation = 'none';
            coreGuide.style.opacity = '0';
            coreGuide.style.transform = 'translate(-50%, -280px) scale(0.8)';
            coreGuide.style.transition = 'all 0.3s ease-out';
            
            // Hide after animation
            setTimeout(() => {
                coreGuide.style.display = 'none';
            }, 300);
            
            // Remember that user has seen the guide
            localStorage.setItem('hasSeenCoreGuide', 'true');
        });
        
        }); // Close DOMContentLoaded
    </script>
</body>
</html>
